<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Cleaning – Jackson Hanson CSCI 0451 Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6de787833effe4777a6777a5e05fb578.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background-image: url(../../img/landscape.png);
background-size: cover;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jackson Hanson CSCI 0451 Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Jackson Hanson</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Data Cleaning</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div id="cell-2" class="cell" data-execution_count="292">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset and filter to Power 5 games</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cfb_box-scores_2002-2024.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>p5 <span class="op">=</span> {<span class="st">"sec"</span>, <span class="st">"acc"</span>, <span class="st">"big10"</span>, <span class="st">"big12"</span>, <span class="st">"pac12"</span>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">"conf_home"</span>].isin(p5) <span class="op">&amp;</span> df[<span class="st">"conf_away"</span>].isin(p5)].copy()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add game-level outcome for reference (not target)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"point_diff"</span>] <span class="op">=</span> df[<span class="st">"score_home"</span>] <span class="op">-</span> df[<span class="st">"score_away"</span>]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base features for per-game averaging</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>features_to_average <span class="op">=</span> [</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pass_yards_home'</span>, <span class="st">'pass_yards_away'</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rush_yards_home'</span>, <span class="st">'rush_yards_away'</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'total_yards_home'</span>, <span class="st">'total_yards_away'</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pass_att_home'</span>, <span class="st">'pass_att_away'</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'third_down_comp_home'</span>, <span class="st">'third_down_comp_away'</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'third_down_att_home'</span>, <span class="st">'third_down_att_away'</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pen_num_home'</span>, <span class="st">'pen_num_away'</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pen_yards_home'</span>, <span class="st">'pen_yards_away'</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fum_home'</span>, <span class="st">'fum_away'</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'int_home'</span>, <span class="st">'int_away'</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'first_downs_home'</span>, <span class="st">'first_downs_away'</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'possession_home'</span>, <span class="st">'possession_away'</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort chronologically</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values([<span class="st">"season"</span>, <span class="st">"week"</span>])</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to long format for rolling averages</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>home_stats <span class="op">=</span> df[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"home"</span>] <span class="op">+</span> [f <span class="cf">for</span> f <span class="kw">in</span> features_to_average <span class="cf">if</span> f.endswith(<span class="st">"_home"</span>)]].copy()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>away_stats <span class="op">=</span> df[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"away"</span>] <span class="op">+</span> [f <span class="cf">for</span> f <span class="kw">in</span> features_to_average <span class="cf">if</span> f.endswith(<span class="st">"_away"</span>)]].copy()</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>home_stats.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [f.replace(<span class="st">"_home"</span>, <span class="st">""</span>) <span class="cf">for</span> f <span class="kw">in</span> home_stats.columns[<span class="dv">3</span>:]]</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>away_stats.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [f.replace(<span class="st">"_away"</span>, <span class="st">""</span>) <span class="cf">for</span> f <span class="kw">in</span> away_stats.columns[<span class="dv">3</span>:]]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>team_stats <span class="op">=</span> pd.concat([home_stats, away_stats], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>team_stats <span class="op">=</span> team_stats.sort_values([<span class="st">"team"</span>, <span class="st">"season"</span>, <span class="st">"week"</span>])</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Custom feature engineering per team per game ---</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"penalty_rate"</span>] <span class="op">=</span> team_stats[<span class="st">"pen_yards"</span>] <span class="op">/</span> team_stats[<span class="st">"pen_num"</span>].replace(<span class="dv">0</span>, np.nan)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"turnovers"</span>] <span class="op">=</span> team_stats[<span class="st">"fum"</span>] <span class="op">+</span> team_stats[<span class="st">"int"</span>]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"pass_eff"</span>] <span class="op">=</span> team_stats[<span class="st">"pass_yards"</span>] <span class="op">/</span> team_stats[<span class="st">"pass_att"</span>].replace(<span class="dv">0</span>, np.nan)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"third_down_pct"</span>] <span class="op">=</span> team_stats[<span class="st">"third_down_comp"</span>] <span class="op">/</span> team_stats[<span class="st">"third_down_att"</span>].replace(<span class="dv">0</span>, np.nan)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Compute rolling averages (exclude current game) ---</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>all_rolling_feats <span class="op">=</span> [</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pass_yards'</span>, <span class="st">'rush_yards'</span>, <span class="st">'total_yards'</span>, <span class="st">'pass_att'</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'third_down_comp'</span>, <span class="st">'third_down_att'</span>, <span class="st">'pen_num'</span>, <span class="st">'pen_yards'</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fum'</span>, <span class="st">'int'</span>, <span class="st">'first_downs'</span>, <span class="st">'possession'</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'penalty_rate'</span>, <span class="st">'turnovers'</span>, <span class="st">'pass_eff'</span>, <span class="st">'third_down_pct'</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats:</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    team_stats[<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg"</span>] <span class="op">=</span> team_stats.groupby([<span class="st">"team"</span>, <span class="st">"season"</span>])[feat].shift(<span class="dv">1</span>).expanding().mean()</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Merge rolling features back into main df for home and away teams ---</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co"># For home</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>home_avg <span class="op">=</span> team_stats[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]].copy()</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>home_avg.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"home"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_home"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(home_avg, on<span class="op">=</span>[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"home"</span>], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># For away</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>away_avg <span class="op">=</span> team_stats[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]].copy()</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>away_avg.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"away"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_away"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(away_avg, on<span class="op">=</span>[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"away"</span>], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NaNs (early season games)</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>avg_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> <span class="st">"_avg_"</span> <span class="kw">in</span> col]</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>df[avg_cols] <span class="op">=</span> df[avg_cols].fillna(<span class="dv">0</span>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co">#For teams that are unranked, we will rank them 26</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Final feature and target setup ---</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>model_features <span class="op">=</span> (</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_home"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats] <span class="op">+</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_away"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats] <span class="op">+</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'rank_home'</span>, <span class="st">'rank_away'</span>, <span class="st">'neutral'</span>]</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[model_features].copy()</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[[<span class="st">"score_home"</span>, <span class="st">"score_away"</span>]].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Only the top 25 teams are ranked in CFB, so we chose to impute the N/A values for the unranked teams as 26 for every team that isn’t in the top 25 for a given week.</p>
<div id="cell-4" class="cell" data-execution_count="293">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix rank columns: fill missing with 26 (unranked)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"rank_home"</span>] <span class="op">=</span> X[<span class="st">"rank_home"</span>].fillna(<span class="dv">26</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"rank_away"</span>] <span class="op">=</span> X[<span class="st">"rank_away"</span>].fillna(<span class="dv">26</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure neutral is integer type</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"neutral"</span>] <span class="op">=</span> X[<span class="st">"neutral"</span>].astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="294">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="294">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pass_yards_avg_home</th>
<th data-quarto-table-cell-role="th">rush_yards_avg_home</th>
<th data-quarto-table-cell-role="th">total_yards_avg_home</th>
<th data-quarto-table-cell-role="th">pass_att_avg_home</th>
<th data-quarto-table-cell-role="th">third_down_comp_avg_home</th>
<th data-quarto-table-cell-role="th">third_down_att_avg_home</th>
<th data-quarto-table-cell-role="th">pen_num_avg_home</th>
<th data-quarto-table-cell-role="th">pen_yards_avg_home</th>
<th data-quarto-table-cell-role="th">fum_avg_home</th>
<th data-quarto-table-cell-role="th">int_avg_home</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">int_avg_away</th>
<th data-quarto-table-cell-role="th">first_downs_avg_away</th>
<th data-quarto-table-cell-role="th">possession_avg_away</th>
<th data-quarto-table-cell-role="th">penalty_rate_avg_away</th>
<th data-quarto-table-cell-role="th">turnovers_avg_away</th>
<th data-quarto-table-cell-role="th">pass_eff_avg_away</th>
<th data-quarto-table-cell-role="th">third_down_pct_avg_away</th>
<th data-quarto-table-cell-role="th">rank_home</th>
<th data-quarto-table-cell-role="th">rank_away</th>
<th data-quarto-table-cell-role="th">neutral</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>227.774801</td>
<td>156.728703</td>
<td>379.234854</td>
<td>31.375487</td>
<td>5.536521</td>
<td>14.313347</td>
<td>5.379069</td>
<td>46.128796</td>
<td>0.718112</td>
<td>0.910917</td>
<td>...</td>
<td>0.904317</td>
<td>20.255369</td>
<td>26.059720</td>
<td>8.628327</td>
<td>1.613509</td>
<td>7.457099</td>
<td>0.387419</td>
<td>13.0</td>
<td>26.0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>227.384694</td>
<td>156.839426</td>
<td>378.973864</td>
<td>31.292962</td>
<td>5.521011</td>
<td>14.281517</td>
<td>5.387598</td>
<td>46.168944</td>
<td>0.713700</td>
<td>0.903997</td>
<td>...</td>
<td>0.782152</td>
<td>21.685039</td>
<td>26.109974</td>
<td>8.552194</td>
<td>1.467192</td>
<td>8.093595</td>
<td>0.421920</td>
<td>10.0</td>
<td>26.0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>229.408866</td>
<td>160.187227</td>
<td>384.243220</td>
<td>31.282881</td>
<td>5.528142</td>
<td>14.247594</td>
<td>5.458443</td>
<td>46.726451</td>
<td>0.735491</td>
<td>0.893847</td>
<td>...</td>
<td>0.896127</td>
<td>20.560739</td>
<td>25.831144</td>
<td>8.537351</td>
<td>1.636444</td>
<td>7.497680</td>
<td>0.386261</td>
<td>26.0</td>
<td>3.0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>227.836879</td>
<td>158.091573</td>
<td>380.618481</td>
<td>31.172716</td>
<td>5.490613</td>
<td>14.233417</td>
<td>5.442011</td>
<td>46.477263</td>
<td>0.727159</td>
<td>0.896120</td>
<td>...</td>
<td>0.909896</td>
<td>20.302460</td>
<td>26.066662</td>
<td>8.643987</td>
<td>1.618245</td>
<td>7.447962</td>
<td>0.387069</td>
<td>13.0</td>
<td>11.0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>229.408866</td>
<td>160.187227</td>
<td>384.243220</td>
<td>31.282881</td>
<td>5.528142</td>
<td>14.247594</td>
<td>5.458443</td>
<td>46.726451</td>
<td>0.735491</td>
<td>0.893847</td>
<td>...</td>
<td>0.895494</td>
<td>20.129665</td>
<td>25.813096</td>
<td>8.585388</td>
<td>1.625104</td>
<td>7.484326</td>
<td>0.384965</td>
<td>26.0</td>
<td>26.0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6949</td>
<td>231.722892</td>
<td>159.923439</td>
<td>386.800000</td>
<td>31.592881</td>
<td>5.575465</td>
<td>14.289485</td>
<td>5.473165</td>
<td>47.079189</td>
<td>0.708981</td>
<td>0.905257</td>
<td>...</td>
<td>0.902841</td>
<td>19.977788</td>
<td>25.975322</td>
<td>8.625031</td>
<td>1.618918</td>
<td>7.429962</td>
<td>0.385463</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6950</td>
<td>231.722892</td>
<td>159.923439</td>
<td>386.800000</td>
<td>31.592881</td>
<td>5.575465</td>
<td>14.289485</td>
<td>5.473165</td>
<td>47.079189</td>
<td>0.708981</td>
<td>0.905257</td>
<td>...</td>
<td>0.902704</td>
<td>19.977791</td>
<td>25.975791</td>
<td>8.624761</td>
<td>1.618674</td>
<td>7.430693</td>
<td>0.385459</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6951</td>
<td>231.728507</td>
<td>159.912277</td>
<td>386.794984</td>
<td>31.593692</td>
<td>5.575402</td>
<td>14.289563</td>
<td>5.473114</td>
<td>47.079947</td>
<td>0.709013</td>
<td>0.905268</td>
<td>...</td>
<td>0.902826</td>
<td>19.977180</td>
<td>25.974286</td>
<td>8.625079</td>
<td>1.619012</td>
<td>7.429540</td>
<td>0.385454</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6952</td>
<td>231.728507</td>
<td>159.912277</td>
<td>386.794984</td>
<td>31.593692</td>
<td>5.575402</td>
<td>14.289563</td>
<td>5.473114</td>
<td>47.079947</td>
<td>0.709013</td>
<td>0.905268</td>
<td>...</td>
<td>0.902841</td>
<td>19.977788</td>
<td>25.975322</td>
<td>8.625031</td>
<td>1.618918</td>
<td>7.429962</td>
<td>0.385463</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6953</td>
<td>231.728507</td>
<td>159.912277</td>
<td>386.794984</td>
<td>31.593692</td>
<td>5.575402</td>
<td>14.289563</td>
<td>5.473114</td>
<td>47.079947</td>
<td>0.709013</td>
<td>0.905268</td>
<td>...</td>
<td>0.902704</td>
<td>19.977791</td>
<td>25.975791</td>
<td>8.624761</td>
<td>1.618674</td>
<td>7.430693</td>
<td>0.385459</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>6954 rows × 35 columns</p>
</div>
</div>
</div>
<section id="basic-linear-regression-first-attempt" class="level1">
<h1>Basic Linear Regression: First Attempt</h1>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Split into training and test sets</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    X_scaled, y, test_size<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a baseline linear regression model</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>baseline_model <span class="op">=</span> LinearRegression()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>baseline_model.fit(X_train, y_train)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict both home and away scores</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> baseline_model.predict(X_test)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the model</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>mse_home <span class="op">=</span> mean_squared_error(y_test[<span class="st">"score_home"</span>], y_pred[:, <span class="dv">0</span>])</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>mse_away <span class="op">=</span> mean_squared_error(y_test[<span class="st">"score_away"</span>], y_pred[:, <span class="dv">1</span>])</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>mae_home <span class="op">=</span> mean_absolute_error(y_test[<span class="st">"score_home"</span>], y_pred[:, <span class="dv">0</span>])</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>mae_away <span class="op">=</span> mean_absolute_error(y_test[<span class="st">"score_away"</span>], y_pred[:, <span class="dv">1</span>])</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"=== Baseline Linear Regression ==="</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Home Score MSE: </span><span class="sc">{</span>mse_home<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_home<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Away Score MSE: </span><span class="sc">{</span>mse_away<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_away<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Baseline Linear Regression ===
Home Score MSE: 166.80, MAE: 10.40
Away Score MSE: 158.72, MAE: 10.18</code></pre>
</div>
</div>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<div id="cell-9" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 1: Calculate True vs. Predicted Values ---</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>true_h <span class="op">=</span> y_test[<span class="st">"score_home"</span>].values</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>pred_h <span class="op">=</span> y_pred[:, <span class="dv">0</span>]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>true_a <span class="op">=</span> y_test[<span class="st">"score_away"</span>].values</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>pred_a <span class="op">=</span> y_pred[:, <span class="dv">1</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 2: Compute Residuals ---</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>resid_home <span class="op">=</span> true_h <span class="op">-</span> pred_h</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>resid_away <span class="op">=</span> true_a <span class="op">-</span> pred_a</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 3: Build Visualization DataFrame ---</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>df_vis <span class="op">=</span> pd.DataFrame({</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'true_home'</span>: true_h,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pred_home'</span>: pred_h,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'resid_home'</span>: resid_home,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'true_away'</span>: true_a,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pred_away'</span>: pred_a,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'resid_away'</span>: resid_away</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>y_test.index)  <span class="co"># retain original indices for week/season</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># If your test set also has 'week' and 'season', bring them in</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'week'</span> <span class="kw">in</span> y_test.columns:</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    df_vis[<span class="st">'week'</span>] <span class="op">=</span> y_test[<span class="st">'week'</span>]</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'season'</span> <span class="kw">in</span> y_test.columns:</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    df_vis[<span class="st">'season'</span>] <span class="op">=</span> y_test[<span class="st">'season'</span>]</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 4: R² Scores ---</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Home R²:"</span>, r2_score(true_h, pred_h))</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Away R²:"</span>, r2_score(true_a, pred_a))</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 5: True vs. Predicted Plot ---</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>true_h, y<span class="op">=</span>pred_h, scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>: <span class="fl">0.3</span>}, line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"green"</span>, <span class="st">"label"</span>: <span class="st">"best-fit"</span>})</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">70</span>], [<span class="dv">0</span>, <span class="dv">70</span>], <span class="st">"r--"</span>, label<span class="op">=</span><span class="st">"ideal"</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True Home Score"</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Home Score"</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home: True vs Predicted with Best-Fit Line"</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>true_a, y<span class="op">=</span>pred_a, scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>: <span class="fl">0.3</span>}, line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"green"</span>, <span class="st">"label"</span>: <span class="st">"best-fit"</span>})</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">70</span>], [<span class="dv">0</span>, <span class="dv">70</span>], <span class="st">"r--"</span>, label<span class="op">=</span><span class="st">"ideal"</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True Away Score"</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Away Score"</span>)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away: True vs Predicted with Best-Fit Line"</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 6: Residual Histograms ---</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_vis[<span class="st">'resid_home'</span>], bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Residuals (True - Pred)"</span>)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_vis[<span class="st">'resid_away'</span>], bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Residuals (True - Pred)"</span>)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 7: Residuals vs. Predicted ---</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'pred_home'</span>, y<span class="op">=</span><span class="st">'resid_home'</span>, data<span class="op">=</span>df_vis, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Home Score"</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Home Residual"</span>)</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Residuals vs. Predicted"</span>)</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'pred_away'</span>, y<span class="op">=</span><span class="st">'resid_away'</span>, data<span class="op">=</span>df_vis, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Away Score"</span>)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Away Residual"</span>)</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Residuals vs. Predicted"</span>)</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Home R²: 0.13192892692752833
Away R²: 0.13614731412352565</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="basic-linear-regression-improved-features" class="level1">
<h1>Basic Linear Regression: Improved Features</h1>
<p>In the initial version of the model, while the data processing was thorough and well-structured, there were several key limitations that likely impacted predictive accuracy. First, the use of expanding averages for team stats gave equal weight to all past games, failing to account for more recent performance, which is often more indicative of a team’s current strength. Additionally, early-season games with no prior data were imputed with zeros, introducing unrealistic noise into the model. The train/test split was done randomly rather than chronologically, leading to potential data leakage from future games into the training set. Furthermore, the model lacked opponent-adjusted features, contextual variables like season or week, and did not address multicollinearity among highly correlated stats. In the improved version, we replaced expanding means with 4-game rolling averages to emphasize recent performance, used chronological train/test splitting to preserve time-series integrity, added deltas between home and away rolling stats to better capture relative matchups, and included season and week as control variables. We also applied mean imputation to handle any remaining missing values robustly and scaled features properly before fitting the model, resulting in a cleaner, more context-aware baseline.</p>
<div id="cell-12" class="cell" data-execution_count="298">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load and Filter Dataset</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cfb_box-scores_2002-2024.csv"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>p5 <span class="op">=</span> {<span class="st">"sec"</span>, <span class="st">"acc"</span>, <span class="st">"big10"</span>, <span class="st">"big12"</span>, <span class="st">"pac12"</span>}</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">"conf_home"</span>].isin(p5) <span class="op">&amp;</span> df[<span class="st">"conf_away"</span>].isin(p5)].copy()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"point_diff"</span>] <span class="op">=</span> df[<span class="st">"score_home"</span>] <span class="op">-</span> df[<span class="st">"score_away"</span>]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values([<span class="st">"season"</span>, <span class="st">"week"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Rolling Feature Engineering</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>features_to_average <span class="op">=</span> [</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pass_yards_home'</span>, <span class="st">'pass_yards_away'</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rush_yards_home'</span>, <span class="st">'rush_yards_away'</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'total_yards_home'</span>, <span class="st">'total_yards_away'</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pass_att_home'</span>, <span class="st">'pass_att_away'</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'third_down_comp_home'</span>, <span class="st">'third_down_comp_away'</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'third_down_att_home'</span>, <span class="st">'third_down_att_away'</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pen_num_home'</span>, <span class="st">'pen_num_away'</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pen_yards_home'</span>, <span class="st">'pen_yards_away'</span>,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fum_home'</span>, <span class="st">'fum_away'</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'int_home'</span>, <span class="st">'int_away'</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'first_downs_home'</span>, <span class="st">'first_downs_away'</span>,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'possession_home'</span>, <span class="st">'possession_away'</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>home_stats <span class="op">=</span> df[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"home"</span>] <span class="op">+</span> [f <span class="cf">for</span> f <span class="kw">in</span> features_to_average <span class="cf">if</span> f.endswith(<span class="st">"_home"</span>)]].copy()</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>away_stats <span class="op">=</span> df[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"away"</span>] <span class="op">+</span> [f <span class="cf">for</span> f <span class="kw">in</span> features_to_average <span class="cf">if</span> f.endswith(<span class="st">"_away"</span>)]].copy()</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>home_stats.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [f.replace(<span class="st">"_home"</span>, <span class="st">""</span>) <span class="cf">for</span> f <span class="kw">in</span> home_stats.columns[<span class="dv">3</span>:]]</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>away_stats.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [f.replace(<span class="st">"_away"</span>, <span class="st">""</span>) <span class="cf">for</span> f <span class="kw">in</span> away_stats.columns[<span class="dv">3</span>:]]</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>team_stats <span class="op">=</span> pd.concat([home_stats, away_stats], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>team_stats <span class="op">=</span> team_stats.sort_values([<span class="st">"team"</span>, <span class="st">"season"</span>, <span class="st">"week"</span>])</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Derived stats</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"penalty_rate"</span>] <span class="op">=</span> team_stats[<span class="st">"pen_yards"</span>] <span class="op">/</span> team_stats[<span class="st">"pen_num"</span>].replace(<span class="dv">0</span>, np.nan)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"turnovers"</span>] <span class="op">=</span> team_stats[<span class="st">"fum"</span>] <span class="op">+</span> team_stats[<span class="st">"int"</span>]</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"pass_eff"</span>] <span class="op">=</span> team_stats[<span class="st">"pass_yards"</span>] <span class="op">/</span> team_stats[<span class="st">"pass_att"</span>].replace(<span class="dv">0</span>, np.nan)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>team_stats[<span class="st">"third_down_pct"</span>] <span class="op">=</span> team_stats[<span class="st">"third_down_comp"</span>] <span class="op">/</span> team_stats[<span class="st">"third_down_att"</span>].replace(<span class="dv">0</span>, np.nan)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co"># All rolling features (with a 4-game window)</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>all_rolling_feats <span class="op">=</span> [</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pass_yards'</span>, <span class="st">'rush_yards'</span>, <span class="st">'total_yards'</span>, <span class="st">'pass_att'</span>,</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'third_down_comp'</span>, <span class="st">'third_down_att'</span>, <span class="st">'pen_num'</span>, <span class="st">'pen_yards'</span>,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fum'</span>, <span class="st">'int'</span>, <span class="st">'first_downs'</span>, <span class="st">'possession'</span>,</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'penalty_rate'</span>, <span class="st">'turnovers'</span>, <span class="st">'pass_eff'</span>, <span class="st">'third_down_pct'</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats:</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    team_stats[<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg"</span>] <span class="op">=</span> (</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        team_stats</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">"team"</span>, <span class="st">"season"</span>])[feat]</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        .shift(<span class="dv">1</span>)</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        .rolling(window<span class="op">=</span><span class="dv">4</span>, min_periods<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        .mean()</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge back rolling averages</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>home_avg <span class="op">=</span> team_stats[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]].copy()</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>home_avg.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"home"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_home"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(home_avg, on<span class="op">=</span>[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"home"</span>], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>away_avg <span class="op">=</span> team_stats[[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"team"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]].copy()</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>away_avg.columns <span class="op">=</span> [<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"away"</span>] <span class="op">+</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_away"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats]</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(away_avg, on<span class="op">=</span>[<span class="st">"season"</span>, <span class="st">"week"</span>, <span class="st">"away"</span>], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Intelligent imputation</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>avg_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> <span class="st">"_avg_"</span> <span class="kw">in</span> col]</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>feature_means <span class="op">=</span> df[avg_cols].mean()</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>df[avg_cols] <span class="op">=</span> df[avg_cols].fillna(feature_means)</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Feature Engineering: Deltas and Control Vars</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute home-away deltas</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats:</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    df[<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_delta"</span>] <span class="op">=</span> df[<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_home"</span>] <span class="op">-</span> df[<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_avg_away"</span>]</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Final feature set</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>model_features <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss">_delta"</span> <span class="cf">for</span> feat <span class="kw">in</span> all_rolling_feats] <span class="op">+</span> [</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rank_home'</span>, <span class="st">'rank_away'</span>, <span class="st">'neutral'</span>, <span class="st">'season'</span>, <span class="st">'week'</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Target variables</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[model_features].copy()</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[[<span class="st">"score_home"</span>, <span class="st">"score_away"</span>]].copy()</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix ranks and neutral</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"rank_home"</span>] <span class="op">=</span> X[<span class="st">"rank_home"</span>].fillna(<span class="dv">26</span>)</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"rank_away"</span>] <span class="op">=</span> X[<span class="st">"rank_away"</span>].fillna(<span class="dv">26</span>)</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"neutral"</span>] <span class="op">=</span> X[<span class="st">"neutral"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Chronological Train/Test Split</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> df[df[<span class="st">"season"</span>] <span class="op">&lt;</span> <span class="dv">2022</span>].copy()</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> df[df[<span class="st">"season"</span>] <span class="op">&gt;=</span> <span class="dv">2022</span>].copy()</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X.loc[train_df.index]</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X.loc[test_df.index]</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> y.loc[train_df.index]</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> y.loc[test_df.index]</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill any remaining NaNs with column means (safety net)</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.fillna(X_train.mean())</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.fillna(X_train.mean())  <span class="co"># use train mean for consistency</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Scale and Fit Linear Model</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression()</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>model.fit(X_train_scaled, y_train)</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test_scaled)</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Evaluate Results</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a><span class="co"># ===========================</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>mse_home <span class="op">=</span> mean_squared_error(y_test[<span class="st">"score_home"</span>], y_pred[:, <span class="dv">0</span>])</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>mae_home <span class="op">=</span> mean_absolute_error(y_test[<span class="st">"score_home"</span>], y_pred[:, <span class="dv">0</span>])</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>mse_away <span class="op">=</span> mean_squared_error(y_test[<span class="st">"score_away"</span>], y_pred[:, <span class="dv">1</span>])</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>mae_away <span class="op">=</span> mean_absolute_error(y_test[<span class="st">"score_away"</span>], y_pred[:, <span class="dv">1</span>])</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"=== Improved Linear Regression Model ==="</span>)</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Home Score - MSE: </span><span class="sc">{</span>mse_home<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_home<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Away Score - MSE: </span><span class="sc">{</span>mse_away<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_away<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Improved Linear Regression Model ===
Home Score - MSE: 152.29, MAE: 10.05
Away Score - MSE: 138.24, MAE: 9.60</code></pre>
</div>
</div>
<section id="visualizations-1" class="level2">
<h2 class="anchored" data-anchor-id="visualizations-1">Visualizations</h2>
<div id="cell-14" class="cell" data-execution_count="299">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Home score</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>true_h <span class="op">=</span> y_test[<span class="st">"score_home"</span>].values</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>pred_h <span class="op">=</span> y_pred[:,<span class="dv">0</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Home R²:"</span>, r2_score(true_h, pred_h))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>true_h, y<span class="op">=</span>pred_h,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>:<span class="fl">0.3</span>},</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>:<span class="st">"green"</span>, <span class="st">"label"</span>:<span class="st">"best‐fit"</span>})</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">70</span>],[<span class="dv">0</span>,<span class="dv">70</span>],<span class="st">"r--"</span>, label<span class="op">=</span><span class="st">"ideal"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True Home Score"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Home Score"</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home: True vs Predicted with Best‐Fit Line"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Away score</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>true_a <span class="op">=</span> y_test[<span class="st">"score_away"</span>].values</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>pred_a <span class="op">=</span> y_pred[:,<span class="dv">1</span>]</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Away R²:"</span>, r2_score(true_a, pred_a))</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>true_a, y<span class="op">=</span>pred_a,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>:<span class="fl">0.3</span>},</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>:<span class="st">"green"</span>, <span class="st">"label"</span>:<span class="st">"best‐fit"</span>})</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">70</span>],[<span class="dv">0</span>,<span class="dv">70</span>],<span class="st">"r--"</span>, label<span class="op">=</span><span class="st">"ideal"</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True Away Score"</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Away Score"</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away: True vs Predicted with Best‐Fit Line"</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Residual histograms</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_vis[<span class="st">'resid_home'</span>], bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Residuals (True − Pred)"</span>) </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_vis[<span class="st">'resid_away'</span>], bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Residuals (True − Pred)"</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Residuals vs. Predicted (check for heteroscedasticity)</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'pred_home'</span>, y<span class="op">=</span><span class="st">'resid_home'</span>, data<span class="op">=</span>df_vis, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Home"</span>)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residual Home"</span>)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Residuals vs. Predicted"</span>)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'pred_away'</span>, y<span class="op">=</span><span class="st">'resid_away'</span>, data<span class="op">=</span>df_vis, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Away"</span>)</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residual Away"</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Residuals vs. Predicted"</span>)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Home R²: 0.11223269358333654</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Away R²: 0.09936412375547488</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="284">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Home score</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>true_h <span class="op">=</span> y_test[<span class="st">"score_home"</span>].values</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>pred_h <span class="op">=</span> y_pred[:,<span class="dv">0</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Home R²:"</span>, r2_score(true_h, pred_h))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>true_h, y<span class="op">=</span>pred_h,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>:<span class="fl">0.3</span>},</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>:<span class="st">"green"</span>, <span class="st">"label"</span>:<span class="st">"best‐fit"</span>})</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">70</span>],[<span class="dv">0</span>,<span class="dv">70</span>],<span class="st">"r--"</span>, label<span class="op">=</span><span class="st">"ideal"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True Home Score"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Home Score"</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home: True vs Predicted with Best‐Fit Line"</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Away score</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>true_a <span class="op">=</span> y_test[<span class="st">"score_away"</span>].values</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>pred_a <span class="op">=</span> y_pred[:,<span class="dv">1</span>]</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Away R²:"</span>, r2_score(true_a, pred_a))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>true_a, y<span class="op">=</span>pred_a,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">"alpha"</span>:<span class="fl">0.3</span>},</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">"color"</span>:<span class="st">"green"</span>, <span class="st">"label"</span>:<span class="st">"best‐fit"</span>})</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">70</span>],[<span class="dv">0</span>,<span class="dv">70</span>],<span class="st">"r--"</span>, label<span class="op">=</span><span class="st">"ideal"</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True Away Score"</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Away Score"</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away: True vs Predicted with Best‐Fit Line"</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Residual histograms</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_vis[<span class="st">'resid_home'</span>], bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Residuals (True − Pred)"</span>) </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_vis[<span class="st">'resid_away'</span>], bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Residuals (True − Pred)"</span>)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Residuals vs. Predicted (check for heteroscedasticity)</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'pred_home'</span>, y<span class="op">=</span><span class="st">'resid_home'</span>, data<span class="op">=</span>df_vis, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Home"</span>)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residual Home"</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Residuals vs. Predicted"</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'pred_away'</span>, y<span class="op">=</span><span class="st">'resid_away'</span>, data<span class="op">=</span>df_vis, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Away"</span>)</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residual Away"</span>)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Residuals vs. Predicted"</span>)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Home R²: 0.11223269358333654</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Away R²: 0.09936412375547488</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-9-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="neural-networks" class="level1">
<h1>Neural Networks</h1>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cfb <span class="im">import</span> FootballNet, MultiObjectiveLoss, FootballNetSplit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload</code></pre>
</div>
</div>
<p>In this section, we are tuning our model. We are going to tune our</p>
<div id="cell-19" class="cell" data-execution_count="286">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="286">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pass_yards_delta</th>
<th data-quarto-table-cell-role="th">rush_yards_delta</th>
<th data-quarto-table-cell-role="th">total_yards_delta</th>
<th data-quarto-table-cell-role="th">pass_att_delta</th>
<th data-quarto-table-cell-role="th">third_down_comp_delta</th>
<th data-quarto-table-cell-role="th">third_down_att_delta</th>
<th data-quarto-table-cell-role="th">pen_num_delta</th>
<th data-quarto-table-cell-role="th">pen_yards_delta</th>
<th data-quarto-table-cell-role="th">fum_delta</th>
<th data-quarto-table-cell-role="th">int_delta</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">possession_delta</th>
<th data-quarto-table-cell-role="th">penalty_rate_delta</th>
<th data-quarto-table-cell-role="th">turnovers_delta</th>
<th data-quarto-table-cell-role="th">pass_eff_delta</th>
<th data-quarto-table-cell-role="th">third_down_pct_delta</th>
<th data-quarto-table-cell-role="th">rank_home</th>
<th data-quarto-table-cell-role="th">rank_away</th>
<th data-quarto-table-cell-role="th">neutral</th>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">week</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>44.666667</td>
<td>37.666667</td>
<td>82.333333</td>
<td>4.000000</td>
<td>-1.333333</td>
<td>-2.333333</td>
<td>-3.333333</td>
<td>-26.000000</td>
<td>-0.333333</td>
<td>-0.666667</td>
<td>...</td>
<td>2.706667</td>
<td>1.071429</td>
<td>-1.000000</td>
<td>0.595998</td>
<td>-0.025439</td>
<td>13.0</td>
<td>26.0</td>
<td>0</td>
<td>2002</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-63.333333</td>
<td>154.000000</td>
<td>90.666667</td>
<td>-8.000000</td>
<td>-4.333333</td>
<td>-4.333333</td>
<td>-1.000000</td>
<td>-9.666667</td>
<td>0.000000</td>
<td>1.000000</td>
<td>...</td>
<td>-0.130000</td>
<td>0.036111</td>
<td>1.000000</td>
<td>0.178603</td>
<td>-0.132628</td>
<td>10.0</td>
<td>26.0</td>
<td>0</td>
<td>2002</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-54.000000</td>
<td>-26.666667</td>
<td>-80.666667</td>
<td>-8.333333</td>
<td>-2.333333</td>
<td>-1.333333</td>
<td>-3.000000</td>
<td>-23.000000</td>
<td>0.333333</td>
<td>-0.333333</td>
<td>...</td>
<td>0.220000</td>
<td>2.364286</td>
<td>0.000000</td>
<td>0.485421</td>
<td>-0.157143</td>
<td>26.0</td>
<td>3.0</td>
<td>0</td>
<td>2002</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>121.333333</td>
<td>50.000000</td>
<td>171.333333</td>
<td>7.666667</td>
<td>0.333333</td>
<td>-3.333333</td>
<td>1.666667</td>
<td>23.333333</td>
<td>0.000000</td>
<td>-1.666667</td>
<td>...</td>
<td>2.176667</td>
<td>2.817460</td>
<td>-1.666667</td>
<td>2.021605</td>
<td>0.127056</td>
<td>13.0</td>
<td>11.0</td>
<td>0</td>
<td>2002</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-115.500000</td>
<td>12.833333</td>
<td>-102.666667</td>
<td>-23.166667</td>
<td>-3.833333</td>
<td>-3.333333</td>
<td>0.166667</td>
<td>5.833333</td>
<td>-0.500000</td>
<td>-0.666667</td>
<td>...</td>
<td>-4.293333</td>
<td>5.000000</td>
<td>-1.166667</td>
<td>0.991651</td>
<td>-0.238095</td>
<td>26.0</td>
<td>26.0</td>
<td>0</td>
<td>2002</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6949</td>
<td>7.250000</td>
<td>74.000000</td>
<td>81.250000</td>
<td>3.750000</td>
<td>1.750000</td>
<td>3.250000</td>
<td>1.750000</td>
<td>8.750000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>...</td>
<td>3.405000</td>
<td>-2.301136</td>
<td>1.000000</td>
<td>-0.851248</td>
<td>0.036373</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
<td>2024</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6950</td>
<td>-10.750000</td>
<td>72.000000</td>
<td>61.250000</td>
<td>3.250000</td>
<td>1.750000</td>
<td>3.000000</td>
<td>2.000000</td>
<td>13.250000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>...</td>
<td>3.135000</td>
<td>-1.384470</td>
<td>1.000000</td>
<td>-1.345639</td>
<td>0.045464</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
<td>2024</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6951</td>
<td>44.500000</td>
<td>21.500000</td>
<td>66.000000</td>
<td>5.750000</td>
<td>1.250000</td>
<td>2.750000</td>
<td>1.750000</td>
<td>7.500000</td>
<td>0.750000</td>
<td>0.500000</td>
<td>...</td>
<td>2.375000</td>
<td>-3.184470</td>
<td>1.250000</td>
<td>-0.117791</td>
<td>0.019508</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
<td>2024</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6952</td>
<td>30.250000</td>
<td>25.750000</td>
<td>56.000000</td>
<td>5.750000</td>
<td>1.500000</td>
<td>3.500000</td>
<td>1.750000</td>
<td>12.250000</td>
<td>0.750000</td>
<td>0.250000</td>
<td>...</td>
<td>1.872500</td>
<td>-1.601136</td>
<td>1.000000</td>
<td>-0.577468</td>
<td>0.012563</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
<td>2024</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6953</td>
<td>12.250000</td>
<td>23.750000</td>
<td>36.000000</td>
<td>5.250000</td>
<td>1.500000</td>
<td>3.250000</td>
<td>2.000000</td>
<td>16.750000</td>
<td>0.750000</td>
<td>0.250000</td>
<td>...</td>
<td>1.602500</td>
<td>-0.684470</td>
<td>1.000000</td>
<td>-1.071859</td>
<td>0.021654</td>
<td>5.0</td>
<td>8.0</td>
<td>1</td>
<td>2024</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>6954 rows × 21 columns</p>
</div>
</div>
</div>
<p>=== Improved Linear Regression Model === Home Score - MSE: 152.29, MAE: 10.05 Away Score - MSE: 138.24, MAE: 9.60</p>
<p>custom_loss: dropout: 0.01, lr = .0005, weight decay: 0, hiddensize: 128 custom_loss_with_diff: dropout: 0.2, lr = .001, weight decay: 0, hiddensize: 64 mseloss: dropout: 0.03, lr = .0005, weight decay: 1e-05, hiddensize: 128 margin_weighted_loss: 0.02, lr = .001, weight decay: 0, hiddensize: 128</p>
<div id="cell-21" class="cell" data-execution_count="287">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_and_evaluate_model(input_size, hidden_size, dropout, lr, weight_decay,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                             X_train_tensor, y_train_tensor, X_val_tensor, y_val_tensor, train_loader):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    input_dim <span class="op">=</span> X_train_tensor.shape[<span class="dv">1</span>]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    input_dim_home <span class="op">=</span> input_dim <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    input_dim_away <span class="op">=</span> input_dim <span class="op">-</span> input_dim_home</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> FootballNet(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        input_dim_home<span class="op">=</span>input_dim_home,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        input_dim_away<span class="op">=</span>input_dim_away,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        hidden<span class="op">=</span>hidden_size,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        dropout<span class="op">=</span>dropout</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># model = FootballNet(input_size=input_size, hidden_size=hidden_size, dropout=dropout)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span>lr, weight_decay<span class="op">=</span>weight_decay)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    loss_fn <span class="op">=</span> nn.MSELoss()</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    best_val_loss <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    patience <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    patience_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        model.train()</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        total_loss <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> xb, yb <span class="kw">in</span> train_loader:</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            optimizer.zero_grad()</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> model(xb)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> loss_fn(preds, yb)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>            loss.backward()</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>            optimizer.step()</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            total_loss <span class="op">+=</span> loss.item()</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">eval</span>()</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>            val_preds <span class="op">=</span> model(X_val_tensor)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">=</span> loss_fn(val_preds, y_val_tensor).item()</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val_loss <span class="op">&lt;</span> best_val_loss:</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>            best_val_loss <span class="op">=</span> val_loss</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>            best_model_state <span class="op">=</span> model.state_dict()</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>            patience_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            patience_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> patience_counter <span class="op">&gt;=</span> patience:</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_val_loss, best_model_state, (dropout, lr, weight_decay, hidden_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="288">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WORKKKKK</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader, TensorDataset</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> loss_functions <span class="im">as</span> lf</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume df and model_features are already defined</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values([<span class="st">"season"</span>, <span class="st">"week"</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[model_features].copy()</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[[<span class="st">"score_home"</span>, <span class="st">"score_away"</span>]].copy()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix features</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"rank_home"</span>] <span class="op">=</span> X[<span class="st">"rank_home"</span>].fillna(<span class="dv">26</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"rank_away"</span>] <span class="op">=</span> X[<span class="st">"rank_away"</span>].fillna(<span class="dv">26</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"neutral"</span>] <span class="op">=</span> X[<span class="st">"neutral"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Chronological split: Train = before 2021, Val = 2021, Test = 2022+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> df[df[<span class="st">"season"</span>] <span class="op">&lt;</span> <span class="dv">2021</span>]</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>val_df <span class="op">=</span> df[df[<span class="st">"season"</span>] <span class="op">==</span> <span class="dv">2021</span>]</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> df[df[<span class="st">"season"</span>] <span class="op">&gt;=</span> <span class="dv">2022</span>]</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X.loc[train_df.index].fillna(X.mean())</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> y.loc[train_df.index]</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> X.loc[val_df.index].fillna(X.mean())</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> y.loc[val_df.index]</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X.loc[test_df.index].fillna(X.mean())</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> y.loc[test_df.index]</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale features</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>X_val_scaled <span class="op">=</span> scaler.transform(X_val)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to tensors</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>X_train_tensor <span class="op">=</span> torch.tensor(X_train_scaled, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>y_train_tensor <span class="op">=</span> torch.tensor(y_train.values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>X_val_tensor <span class="op">=</span> torch.tensor(X_val_scaled, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>y_val_tensor <span class="op">=</span> torch.tensor(y_val.values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>X_test_tensor <span class="op">=</span> torch.tensor(X_test_scaled, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>y_test_tensor <span class="op">=</span> torch.tensor(y_test.values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co"># DataLoaders</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(TensorDataset(X_train_tensor, y_train_tensor), batch_size<span class="op">=</span><span class="dv">64</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>val_loader <span class="op">=</span> DataLoader(TensorDataset(X_val_tensor, y_val_tensor), batch_size<span class="op">=</span><span class="dv">64</span>)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>test_loader <span class="op">=</span> DataLoader(TensorDataset(X_test_tensor, y_test_tensor), batch_size<span class="op">=</span><span class="dv">64</span>)</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Hyperparameter ranges --</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>dropouts <span class="op">=</span> [<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>]</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>lrs <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.0005</span>]</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>weight_decays <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">1e-5</span>]</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>hidden_sizes <span class="op">=</span> [<span class="dv">64</span>, <span class="dv">128</span>]</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>loss_fn_dict <span class="op">=</span> {</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"custom_loss"</span>: lf.custom_loss,</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"margin_weighted_loss"</span>: lf.margin_weighted_loss,</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"winner_sensitive_loss"</span>: lf.winner_sensitive_loss,</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"field_goal_scaled_loss"</span>: lf.field_goal_scaled_loss,</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clipped_margin_loss"</span>: lf.clipped_margin_loss</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>loss_names <span class="op">=</span> <span class="bu">list</span>(loss_fn_dict.keys())</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> <span class="bu">list</span>(itertools.product(dropouts, lrs, weight_decays, hidden_sizes, loss_names))</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_and_evaluate_model(input_size, hidden_size, dropout, lr, weight_decay,</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>                             X_train_tensor, y_train_tensor,</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>                             X_val_tensor, y_val_tensor,</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>                             train_loader, loss_fn):</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> FootballNet(input_size<span class="op">=</span>input_size, hidden_size<span class="op">=</span>hidden_size, dropout<span class="op">=</span>dropout)</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span>lr, weight_decay<span class="op">=</span>weight_decay)</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    best_val_loss <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    best_model_state <span class="op">=</span> <span class="va">None</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>    patience <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>    patience_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>        model.train()</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> xb, yb <span class="kw">in</span> train_loader:</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>            optimizer.zero_grad()</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>            preds <span class="op">=</span> model(xb)</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> loss_fn(preds, yb)</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>            loss.backward()</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>            optimizer.step()</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">eval</span>()</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> torch.no_grad():</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>            val_preds <span class="op">=</span> model(X_val_tensor)</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">=</span> loss_fn(val_preds, y_val_tensor).item()</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val_loss <span class="op">&lt;</span> best_val_loss:</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>            best_val_loss <span class="op">=</span> val_loss</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>            best_model_state <span class="op">=</span> model.state_dict()</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>            patience_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>            patience_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> patience_counter <span class="op">&gt;=</span> patience:</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_val_loss, best_model_state, (dropout, lr, weight_decay, hidden_size)</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Run grid search --</span></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (dropout, lr, wd, hidden_size, loss_name) <span class="kw">in</span> <span class="bu">enumerate</span>(grid):</span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Running config </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(grid)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>loss_name<span class="sc">}</span><span class="ss">, hs=</span><span class="sc">{</span>hidden_size<span class="sc">}</span><span class="ss">, dr=</span><span class="sc">{</span>dropout<span class="sc">}</span><span class="ss">, lr=</span><span class="sc">{</span>lr<span class="sc">}</span><span class="ss">, wd=</span><span class="sc">{</span>wd<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>    val_loss, state_dict, config <span class="op">=</span> train_and_evaluate_model(</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>        input_size<span class="op">=</span>X_train_tensor.shape[<span class="dv">1</span>],</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>        hidden_size<span class="op">=</span>hidden_size,</span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>        dropout<span class="op">=</span>dropout,</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>        lr<span class="op">=</span>lr,</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>        weight_decay<span class="op">=</span>wd,</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>        X_train_tensor<span class="op">=</span>X_train_tensor,</span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>        y_train_tensor<span class="op">=</span>y_train_tensor,</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>        X_val_tensor<span class="op">=</span>X_val_tensor,</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a>        y_val_tensor<span class="op">=</span>y_val_tensor,</span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>        train_loader<span class="op">=</span>train_loader,</span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>        loss_fn<span class="op">=</span>loss_fn_dict[loss_name]</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>    results.append({</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Dropout"</span>: dropout,</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Learning Rate"</span>: lr,</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Weight Decay"</span>: wd,</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Hidden Size"</span>: hidden_size,</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Loss Function"</span>: loss_name,</span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Val Loss"</span>: val_loss,</span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">"State Dict"</span>: state_dict</span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a><span class="co"># -- Best result --</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> <span class="bu">sorted</span>(results, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">"Val Loss"</span>])</span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>best_config <span class="op">=</span> results[<span class="dv">0</span>]</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">✅ Best Config:</span><span class="ch">\n</span><span class="sc">{</span>best_config<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running config 1/120: custom_loss, hs=64, dr=0.1, lr=0.001, wd=0.0
Running config 2/120: margin_weighted_loss, hs=64, dr=0.1, lr=0.001, wd=0.0
Running config 3/120: winner_sensitive_loss, hs=64, dr=0.1, lr=0.001, wd=0.0
Running config 4/120: field_goal_scaled_loss, hs=64, dr=0.1, lr=0.001, wd=0.0
Running config 5/120: clipped_margin_loss, hs=64, dr=0.1, lr=0.001, wd=0.0
Running config 6/120: custom_loss, hs=128, dr=0.1, lr=0.001, wd=0.0
Running config 7/120: margin_weighted_loss, hs=128, dr=0.1, lr=0.001, wd=0.0
Running config 8/120: winner_sensitive_loss, hs=128, dr=0.1, lr=0.001, wd=0.0
Running config 9/120: field_goal_scaled_loss, hs=128, dr=0.1, lr=0.001, wd=0.0
Running config 10/120: clipped_margin_loss, hs=128, dr=0.1, lr=0.001, wd=0.0
Running config 11/120: custom_loss, hs=64, dr=0.1, lr=0.001, wd=1e-05
Running config 12/120: margin_weighted_loss, hs=64, dr=0.1, lr=0.001, wd=1e-05
Running config 13/120: winner_sensitive_loss, hs=64, dr=0.1, lr=0.001, wd=1e-05
Running config 14/120: field_goal_scaled_loss, hs=64, dr=0.1, lr=0.001, wd=1e-05
Running config 15/120: clipped_margin_loss, hs=64, dr=0.1, lr=0.001, wd=1e-05
Running config 16/120: custom_loss, hs=128, dr=0.1, lr=0.001, wd=1e-05
Running config 17/120: margin_weighted_loss, hs=128, dr=0.1, lr=0.001, wd=1e-05
Running config 18/120: winner_sensitive_loss, hs=128, dr=0.1, lr=0.001, wd=1e-05
Running config 19/120: field_goal_scaled_loss, hs=128, dr=0.1, lr=0.001, wd=1e-05
Running config 20/120: clipped_margin_loss, hs=128, dr=0.1, lr=0.001, wd=1e-05
Running config 21/120: custom_loss, hs=64, dr=0.1, lr=0.0005, wd=0.0
Running config 22/120: margin_weighted_loss, hs=64, dr=0.1, lr=0.0005, wd=0.0
Running config 23/120: winner_sensitive_loss, hs=64, dr=0.1, lr=0.0005, wd=0.0
Running config 24/120: field_goal_scaled_loss, hs=64, dr=0.1, lr=0.0005, wd=0.0
Running config 25/120: clipped_margin_loss, hs=64, dr=0.1, lr=0.0005, wd=0.0
Running config 26/120: custom_loss, hs=128, dr=0.1, lr=0.0005, wd=0.0
Running config 27/120: margin_weighted_loss, hs=128, dr=0.1, lr=0.0005, wd=0.0
Running config 28/120: winner_sensitive_loss, hs=128, dr=0.1, lr=0.0005, wd=0.0
Running config 29/120: field_goal_scaled_loss, hs=128, dr=0.1, lr=0.0005, wd=0.0
Running config 30/120: clipped_margin_loss, hs=128, dr=0.1, lr=0.0005, wd=0.0
Running config 31/120: custom_loss, hs=64, dr=0.1, lr=0.0005, wd=1e-05
Running config 32/120: margin_weighted_loss, hs=64, dr=0.1, lr=0.0005, wd=1e-05
Running config 33/120: winner_sensitive_loss, hs=64, dr=0.1, lr=0.0005, wd=1e-05
Running config 34/120: field_goal_scaled_loss, hs=64, dr=0.1, lr=0.0005, wd=1e-05
Running config 35/120: clipped_margin_loss, hs=64, dr=0.1, lr=0.0005, wd=1e-05
Running config 36/120: custom_loss, hs=128, dr=0.1, lr=0.0005, wd=1e-05
Running config 37/120: margin_weighted_loss, hs=128, dr=0.1, lr=0.0005, wd=1e-05
Running config 38/120: winner_sensitive_loss, hs=128, dr=0.1, lr=0.0005, wd=1e-05
Running config 39/120: field_goal_scaled_loss, hs=128, dr=0.1, lr=0.0005, wd=1e-05
Running config 40/120: clipped_margin_loss, hs=128, dr=0.1, lr=0.0005, wd=1e-05
Running config 41/120: custom_loss, hs=64, dr=0.2, lr=0.001, wd=0.0
Running config 42/120: margin_weighted_loss, hs=64, dr=0.2, lr=0.001, wd=0.0
Running config 43/120: winner_sensitive_loss, hs=64, dr=0.2, lr=0.001, wd=0.0
Running config 44/120: field_goal_scaled_loss, hs=64, dr=0.2, lr=0.001, wd=0.0
Running config 45/120: clipped_margin_loss, hs=64, dr=0.2, lr=0.001, wd=0.0
Running config 46/120: custom_loss, hs=128, dr=0.2, lr=0.001, wd=0.0
Running config 47/120: margin_weighted_loss, hs=128, dr=0.2, lr=0.001, wd=0.0
Running config 48/120: winner_sensitive_loss, hs=128, dr=0.2, lr=0.001, wd=0.0
Running config 49/120: field_goal_scaled_loss, hs=128, dr=0.2, lr=0.001, wd=0.0
Running config 50/120: clipped_margin_loss, hs=128, dr=0.2, lr=0.001, wd=0.0
Running config 51/120: custom_loss, hs=64, dr=0.2, lr=0.001, wd=1e-05
Running config 52/120: margin_weighted_loss, hs=64, dr=0.2, lr=0.001, wd=1e-05
Running config 53/120: winner_sensitive_loss, hs=64, dr=0.2, lr=0.001, wd=1e-05
Running config 54/120: field_goal_scaled_loss, hs=64, dr=0.2, lr=0.001, wd=1e-05
Running config 55/120: clipped_margin_loss, hs=64, dr=0.2, lr=0.001, wd=1e-05
Running config 56/120: custom_loss, hs=128, dr=0.2, lr=0.001, wd=1e-05
Running config 57/120: margin_weighted_loss, hs=128, dr=0.2, lr=0.001, wd=1e-05
Running config 58/120: winner_sensitive_loss, hs=128, dr=0.2, lr=0.001, wd=1e-05
Running config 59/120: field_goal_scaled_loss, hs=128, dr=0.2, lr=0.001, wd=1e-05
Running config 60/120: clipped_margin_loss, hs=128, dr=0.2, lr=0.001, wd=1e-05
Running config 61/120: custom_loss, hs=64, dr=0.2, lr=0.0005, wd=0.0
Running config 62/120: margin_weighted_loss, hs=64, dr=0.2, lr=0.0005, wd=0.0
Running config 63/120: winner_sensitive_loss, hs=64, dr=0.2, lr=0.0005, wd=0.0
Running config 64/120: field_goal_scaled_loss, hs=64, dr=0.2, lr=0.0005, wd=0.0
Running config 65/120: clipped_margin_loss, hs=64, dr=0.2, lr=0.0005, wd=0.0
Running config 66/120: custom_loss, hs=128, dr=0.2, lr=0.0005, wd=0.0
Running config 67/120: margin_weighted_loss, hs=128, dr=0.2, lr=0.0005, wd=0.0
Running config 68/120: winner_sensitive_loss, hs=128, dr=0.2, lr=0.0005, wd=0.0
Running config 69/120: field_goal_scaled_loss, hs=128, dr=0.2, lr=0.0005, wd=0.0
Running config 70/120: clipped_margin_loss, hs=128, dr=0.2, lr=0.0005, wd=0.0
Running config 71/120: custom_loss, hs=64, dr=0.2, lr=0.0005, wd=1e-05
Running config 72/120: margin_weighted_loss, hs=64, dr=0.2, lr=0.0005, wd=1e-05
Running config 73/120: winner_sensitive_loss, hs=64, dr=0.2, lr=0.0005, wd=1e-05
Running config 74/120: field_goal_scaled_loss, hs=64, dr=0.2, lr=0.0005, wd=1e-05
Running config 75/120: clipped_margin_loss, hs=64, dr=0.2, lr=0.0005, wd=1e-05
Running config 76/120: custom_loss, hs=128, dr=0.2, lr=0.0005, wd=1e-05
Running config 77/120: margin_weighted_loss, hs=128, dr=0.2, lr=0.0005, wd=1e-05
Running config 78/120: winner_sensitive_loss, hs=128, dr=0.2, lr=0.0005, wd=1e-05
Running config 79/120: field_goal_scaled_loss, hs=128, dr=0.2, lr=0.0005, wd=1e-05
Running config 80/120: clipped_margin_loss, hs=128, dr=0.2, lr=0.0005, wd=1e-05
Running config 81/120: custom_loss, hs=64, dr=0.3, lr=0.001, wd=0.0
Running config 82/120: margin_weighted_loss, hs=64, dr=0.3, lr=0.001, wd=0.0
Running config 83/120: winner_sensitive_loss, hs=64, dr=0.3, lr=0.001, wd=0.0
Running config 84/120: field_goal_scaled_loss, hs=64, dr=0.3, lr=0.001, wd=0.0
Running config 85/120: clipped_margin_loss, hs=64, dr=0.3, lr=0.001, wd=0.0
Running config 86/120: custom_loss, hs=128, dr=0.3, lr=0.001, wd=0.0
Running config 87/120: margin_weighted_loss, hs=128, dr=0.3, lr=0.001, wd=0.0
Running config 88/120: winner_sensitive_loss, hs=128, dr=0.3, lr=0.001, wd=0.0
Running config 89/120: field_goal_scaled_loss, hs=128, dr=0.3, lr=0.001, wd=0.0
Running config 90/120: clipped_margin_loss, hs=128, dr=0.3, lr=0.001, wd=0.0
Running config 91/120: custom_loss, hs=64, dr=0.3, lr=0.001, wd=1e-05
Running config 92/120: margin_weighted_loss, hs=64, dr=0.3, lr=0.001, wd=1e-05
Running config 93/120: winner_sensitive_loss, hs=64, dr=0.3, lr=0.001, wd=1e-05
Running config 94/120: field_goal_scaled_loss, hs=64, dr=0.3, lr=0.001, wd=1e-05
Running config 95/120: clipped_margin_loss, hs=64, dr=0.3, lr=0.001, wd=1e-05
Running config 96/120: custom_loss, hs=128, dr=0.3, lr=0.001, wd=1e-05
Running config 97/120: margin_weighted_loss, hs=128, dr=0.3, lr=0.001, wd=1e-05
Running config 98/120: winner_sensitive_loss, hs=128, dr=0.3, lr=0.001, wd=1e-05
Running config 99/120: field_goal_scaled_loss, hs=128, dr=0.3, lr=0.001, wd=1e-05
Running config 100/120: clipped_margin_loss, hs=128, dr=0.3, lr=0.001, wd=1e-05
Running config 101/120: custom_loss, hs=64, dr=0.3, lr=0.0005, wd=0.0
Running config 102/120: margin_weighted_loss, hs=64, dr=0.3, lr=0.0005, wd=0.0
Running config 103/120: winner_sensitive_loss, hs=64, dr=0.3, lr=0.0005, wd=0.0
Running config 104/120: field_goal_scaled_loss, hs=64, dr=0.3, lr=0.0005, wd=0.0
Running config 105/120: clipped_margin_loss, hs=64, dr=0.3, lr=0.0005, wd=0.0
Running config 106/120: custom_loss, hs=128, dr=0.3, lr=0.0005, wd=0.0
Running config 107/120: margin_weighted_loss, hs=128, dr=0.3, lr=0.0005, wd=0.0
Running config 108/120: winner_sensitive_loss, hs=128, dr=0.3, lr=0.0005, wd=0.0
Running config 109/120: field_goal_scaled_loss, hs=128, dr=0.3, lr=0.0005, wd=0.0
Running config 110/120: clipped_margin_loss, hs=128, dr=0.3, lr=0.0005, wd=0.0
Running config 111/120: custom_loss, hs=64, dr=0.3, lr=0.0005, wd=1e-05
Running config 112/120: margin_weighted_loss, hs=64, dr=0.3, lr=0.0005, wd=1e-05
Running config 113/120: winner_sensitive_loss, hs=64, dr=0.3, lr=0.0005, wd=1e-05
Running config 114/120: field_goal_scaled_loss, hs=64, dr=0.3, lr=0.0005, wd=1e-05
Running config 115/120: clipped_margin_loss, hs=64, dr=0.3, lr=0.0005, wd=1e-05
Running config 116/120: custom_loss, hs=128, dr=0.3, lr=0.0005, wd=1e-05
Running config 117/120: margin_weighted_loss, hs=128, dr=0.3, lr=0.0005, wd=1e-05
Running config 118/120: winner_sensitive_loss, hs=128, dr=0.3, lr=0.0005, wd=1e-05
Running config 119/120: field_goal_scaled_loss, hs=128, dr=0.3, lr=0.0005, wd=1e-05
Running config 120/120: clipped_margin_loss, hs=128, dr=0.3, lr=0.0005, wd=1e-05

✅ Best Config:
{'Dropout': 0.3, 'Learning Rate': 0.001, 'Weight Decay': 0.0, 'Hidden Size': 64, 'Loss Function': 'winner_sensitive_loss', 'Val Loss': 109.29098510742188, 'State Dict': OrderedDict({'network.0.weight': tensor([[ 0.0757, -0.1429, -0.1498,  ...,  0.1535, -0.1755, -0.0870],
        [-0.1566,  0.0123,  0.2691,  ..., -0.1012, -0.1748,  0.0814],
        [ 0.0676, -0.2358, -0.2471,  ...,  0.0556, -0.0227,  0.0817],
        ...,
        [-0.2200, -0.0216,  0.1379,  ...,  0.2044,  0.0389, -0.1413],
        [ 0.0489,  0.1641,  0.1496,  ..., -0.0814, -0.0984,  0.1407],
        [ 0.1574,  0.1335, -0.0119,  ...,  0.0593, -0.1792,  0.0652]]), 'network.0.bias': tensor([ 0.2396,  0.2136,  0.1838, -0.0057,  0.1207,  0.0147, -0.0309, -0.0549,
        -0.1417, -0.0286,  0.2620, -0.2352,  0.1066,  0.0623,  0.0291, -0.1063,
        -0.1309, -0.0316, -0.0654, -0.2645, -0.1381, -0.0574,  0.0794,  0.1194,
        -0.0339, -0.1700, -0.0548, -0.0305,  0.0504, -0.0295,  0.1077,  0.1646,
         0.1871,  0.1113,  0.0295, -0.3083,  0.2132,  0.0606,  0.1729, -0.1307,
         0.1126, -0.0705, -0.2510,  0.0312, -0.0250, -0.1495, -0.2413,  0.0713,
        -0.0533, -0.1153, -0.1215, -0.1805,  0.0932, -0.2012, -0.2641, -0.1400,
         0.2772,  0.1096, -0.0184, -0.2241,  0.1783,  0.0659,  0.0769,  0.0833,
        -0.2628, -0.1984, -0.0205,  0.2620, -0.0628, -0.0116,  0.0100,  0.0185,
         0.1015,  0.0434, -0.0013, -0.0854,  0.1391, -0.3425, -0.0136,  0.0736,
        -0.2060,  0.1265,  0.0648, -0.2112, -0.1008,  0.2122,  0.0867, -0.0203,
        -0.2748, -0.1303, -0.2217, -0.0238, -0.2243, -0.1399,  0.2680,  0.0961,
         0.1385, -0.0037,  0.0081, -0.2015, -0.0700, -0.0248, -0.2691, -0.0698,
        -0.1560, -0.0150,  0.0256, -0.0279,  0.1397, -0.2250, -0.2461,  0.0579,
         0.0074,  0.1959,  0.0284, -0.0789, -0.0517, -0.1595, -0.0685,  0.1741,
         0.0644,  0.1902, -0.0536, -0.1170, -0.0592, -0.1089,  0.0352, -0.1421]), 'network.2.weight': tensor([1.0224, 0.9489, 1.0068, 0.9813, 0.9566, 0.9558, 1.0087, 1.0180, 0.9355,
        0.9339, 0.9694, 0.9447, 0.8495, 1.0164, 0.9816, 0.9769, 0.8356, 1.0700,
        0.9159, 1.0119, 1.0201, 1.0163, 1.0462, 1.0589, 1.0485, 0.9538, 0.9370,
        0.9246, 1.0219, 0.9636, 0.9078, 0.9749, 1.0260, 1.0155, 0.9838, 1.0422,
        1.0185, 0.9304, 0.9844, 1.0035, 1.0360, 0.8768, 0.9306, 0.9586, 1.0428,
        0.9640, 1.0242, 1.0026, 1.0025, 1.0084, 0.9628, 0.8513, 0.7571, 0.9725,
        1.0882, 0.9781, 0.9348, 1.0098, 0.9909, 1.0052, 0.9797, 0.9873, 0.9790,
        0.8519, 0.9890, 0.9719, 0.9436, 0.8514, 1.0045, 1.0019, 0.9277, 0.8885,
        1.0421, 0.9838, 0.9616, 0.9257, 0.9243, 0.9940, 1.0406, 1.0588, 1.0024,
        1.0241, 1.0514, 0.9986, 0.9072, 0.9827, 1.1203, 0.9335, 0.9533, 0.9773,
        0.9801, 0.8999, 1.0298, 1.0132, 1.0396, 0.9485, 0.8909, 0.8324, 0.8172,
        0.9478, 0.9298, 0.9133, 0.9581, 1.0105, 0.9880, 0.9609, 0.9717, 0.9880,
        0.9173, 0.9993, 1.0422, 1.0377, 1.0172, 1.0067, 0.9725, 1.0239, 0.9981,
        0.9398, 0.9025, 0.8904, 1.0932, 1.0760, 0.9839, 0.9097, 0.9113, 0.9618,
        0.9960, 1.0001]), 'network.2.bias': tensor([ 1.9390e-01, -1.6954e-01,  1.5213e-01, -5.7867e-02,  6.8493e-02,
        -1.3963e-01,  1.1091e-01, -8.5542e-02, -1.6139e-01, -8.0682e-02,
        -2.0635e-04,  2.1333e-01, -1.5614e-01,  4.7242e-02,  3.0640e-01,
        -8.6167e-02, -1.2485e-01, -1.4370e-01,  6.9554e-02,  3.1511e-01,
         2.4375e-01,  7.7557e-02,  1.5453e-01, -1.4016e-01, -1.2511e-01,
         2.3670e-01,  8.7304e-02, -2.2126e-01,  7.5929e-02, -2.6802e-02,
        -1.6991e-01,  6.8914e-02, -1.7530e-01, -1.4310e-01,  2.8210e-02,
         2.1495e-01,  8.4587e-02,  7.7857e-02, -9.1433e-02, -4.7887e-02,
        -1.3298e-01,  1.3466e-01,  2.0422e-01,  1.9734e-01, -1.1101e-01,
         1.9871e-01,  1.0200e-01, -1.2349e-01,  2.0421e-01, -5.2336e-02,
        -1.2089e-01, -1.3718e-01, -7.8098e-02,  2.2885e-01,  6.1462e-02,
         7.5126e-02, -1.6183e-01, -3.0083e-03,  1.2405e-01,  4.7613e-02,
         1.9447e-01,  1.4864e-01,  7.7611e-02, -8.9319e-02,  3.9675e-02,
         1.7801e-01, -1.0675e-01,  1.4746e-01,  7.2656e-02,  3.9679e-02,
         1.3385e-01,  1.9587e-01,  1.1448e-01,  1.7350e-02, -1.2191e-01,
         1.8455e-01,  1.2525e-01,  2.2823e-01, -1.7425e-01, -9.2573e-02,
        -1.1121e-01, -9.5706e-02,  5.1918e-02,  9.3853e-02,  2.5396e-01,
        -8.2914e-02,  8.2532e-02, -9.5836e-02, -7.4294e-02,  5.2583e-02,
        -9.9196e-02,  2.5264e-01, -1.1620e-01, -5.3226e-02,  1.7460e-01,
         4.0094e-02, -5.8694e-03, -1.2641e-01, -1.0544e-01, -1.0563e-01,
        -2.1596e-01, -1.0728e-01,  5.4713e-02,  1.0136e-01, -1.2976e-01,
        -1.3133e-01,  2.2866e-01, -1.2649e-01, -7.9678e-02,  7.7438e-02,
        -3.6840e-02,  1.7259e-01,  1.3528e-01, -1.4240e-01,  5.2169e-02,
         1.9153e-01, -1.7237e-01,  1.2369e-01, -2.3623e-01, -1.0871e-01,
         1.0579e-01, -5.0160e-03,  1.7828e-01,  8.0010e-02,  8.6554e-02,
        -2.9835e-02, -6.1331e-02,  5.5590e-02]), 'network.2.running_mean': tensor([0.4377, 0.3411, 0.4408, 0.2918, 0.2331, 0.2058, 0.2271, 0.2988, 0.1956,
        0.2875, 0.3965, 0.1192, 0.3016, 0.3522, 0.2891, 0.1963, 0.2444, 0.2518,
        0.2707, 0.1609, 0.2099, 0.2458, 0.2797, 0.2470, 0.2443, 0.1557, 0.2251,
        0.1728, 0.3327, 0.2904, 0.4308, 0.3455, 0.2907, 0.3586, 0.2736, 0.0387,
        0.3906, 0.2337, 0.4462, 0.2113, 0.3902, 0.2912, 0.1111, 0.2720, 0.3491,
        0.1473, 0.0914, 0.3018, 0.2250, 0.1729, 0.2279, 0.2375, 0.4615, 0.2139,
        0.1352, 0.1705, 0.4522, 0.3351, 0.2405, 0.1689, 0.4585, 0.2565, 0.3037,
        0.2546, 0.1188, 0.1549, 0.2714, 0.4323, 0.2512, 0.1964, 0.2995, 0.3379,
        0.3283, 0.2808, 0.2870, 0.1937, 0.4000, 0.0303, 0.2320, 0.3608, 0.1332,
        0.3777, 0.2990, 0.2053, 0.2665, 0.3418, 0.3303, 0.2815, 0.1559, 0.2219,
        0.0870, 0.2116, 0.2107, 0.2041, 0.4725, 0.3268, 0.3736, 0.3255, 0.2334,
        0.1016, 0.2743, 0.3377, 0.1147, 0.2164, 0.2094, 0.2523, 0.2213, 0.2402,
        0.3265, 0.1390, 0.1098, 0.2549, 0.2541, 0.4340, 0.3088, 0.2164, 0.2173,
        0.1714, 0.2179, 0.4604, 0.2186, 0.3339, 0.2332, 0.1730, 0.2438, 0.1992,
        0.2751, 0.1408]), 'network.2.running_var': tensor([0.2655, 0.1423, 0.3234, 0.1826, 0.0926, 0.0875, 0.1361, 0.1923, 0.0918,
        0.1784, 0.2142, 0.0569, 0.1536, 0.2342, 0.1853, 0.1160, 0.2056, 0.1511,
        0.1773, 0.1014, 0.1437, 0.1363, 0.1381, 0.0893, 0.1123, 0.0978, 0.1263,
        0.0763, 0.2425, 0.2024, 0.3359, 0.1843, 0.1138, 0.1577, 0.1281, 0.0161,
        0.2149, 0.0894, 0.3164, 0.1436, 0.2806, 0.2210, 0.0531, 0.1879, 0.2389,
        0.0689, 0.0371, 0.1638, 0.1441, 0.0753, 0.1456, 0.1774, 0.4077, 0.1375,
        0.0780, 0.0882, 0.2479, 0.1897, 0.1466, 0.1030, 0.3698, 0.1178, 0.1859,
        0.1314, 0.0633, 0.0768, 0.1627, 0.2358, 0.1481, 0.0744, 0.2105, 0.2681,
        0.1874, 0.1714, 0.1413, 0.1078, 0.2532, 0.0089, 0.1123, 0.2309, 0.0663,
        0.2233, 0.1893, 0.1478, 0.2130, 0.1373, 0.1906, 0.1864, 0.1010, 0.1431,
        0.0371, 0.1252, 0.1327, 0.1462, 0.3369, 0.1474, 0.2812, 0.2403, 0.1126,
        0.0395, 0.1833, 0.2961, 0.0545, 0.1392, 0.1016, 0.1255, 0.1018, 0.1479,
        0.1544, 0.0824, 0.0558, 0.1310, 0.1024, 0.2764, 0.1977, 0.1160, 0.1020,
        0.1167, 0.1163, 0.3608, 0.0981, 0.1541, 0.1324, 0.0868, 0.1241, 0.1174,
        0.1449, 0.0633]), 'network.2.num_batches_tracked': tensor(2349), 'network.4.weight': tensor([[ 0.0729, -0.1428, -0.0571,  ..., -0.0051, -0.0901,  0.0271],
        [ 0.0597, -0.0182,  0.0712,  ...,  0.0092, -0.0771,  0.0907],
        [-0.0330, -0.0867,  0.0018,  ..., -0.0624, -0.2357, -0.0093],
        ...,
        [-0.0060, -0.0881,  0.0676,  ...,  0.0188,  0.0800,  0.0266],
        [-0.0599,  0.0396, -0.0892,  ..., -0.0363,  0.0904, -0.1388],
        [-0.1467,  0.0342, -0.1435,  ..., -0.0610, -0.0327,  0.0586]]), 'network.4.bias': tensor([ 0.0165,  0.0306,  0.1184, -0.0552,  0.4026,  0.1686, -0.1877, -0.0436,
         0.1769,  0.0862, -0.0876,  0.1090,  0.0523,  0.0607,  0.1518,  0.0265,
        -0.0436,  0.3686, -0.1165,  0.2245, -0.1751, -0.1042,  0.0394,  0.0138,
        -0.0472, -0.0725,  0.1109,  0.0982, -0.1392,  0.4035,  0.3595,  0.1281,
        -0.0125, -0.1178, -0.1598,  0.0445, -0.1410, -0.0705, -0.2745, -0.0404,
         0.1003,  0.0558, -0.0151,  0.3298,  0.1273,  0.2353,  0.0933, -0.0903,
         0.2226,  0.1730, -0.0154,  0.4219,  0.0749, -0.1066,  0.2146,  0.1884,
         0.0106,  0.2571,  0.1949,  0.2311, -0.2175,  0.3237, -0.0793, -0.0506]), 'network.6.weight': tensor([1.2581, 1.1943, 1.2925, 1.2456, 1.1787, 1.1792, 1.2182, 1.1366, 1.2298,
        1.2448, 1.1792, 1.3394, 1.2304, 1.1837, 1.2122, 1.1853, 1.1255, 1.0850,
        1.2520, 1.2052, 1.1842, 1.2123, 1.1792, 1.2656, 1.1592, 1.1624, 1.2185,
        1.1887, 1.2430, 1.1058, 1.1743, 1.2033, 1.1701, 1.2098, 1.2332, 1.1455,
        1.2619, 1.1814, 1.2442, 1.2297, 1.2039, 1.2285, 1.1659, 1.1768, 1.2339,
        1.1828, 1.1685, 1.1695, 1.1852, 1.2643, 1.2078, 1.1141, 1.2437, 1.2935,
        1.3717, 1.1824, 1.1687, 1.1506, 1.2104, 1.1947, 1.2328, 1.2006, 1.1479,
        1.1716]), 'network.6.bias': tensor([-9.0004e-02, -4.6516e-01, -9.9424e-02, -4.1284e-01,  2.7897e-01,
         6.7268e-02, -3.7189e-01, -2.2379e-01,  2.9939e-04,  7.0111e-02,
        -3.2061e-01, -3.3231e-01, -1.7359e-01, -2.1570e-01, -7.4254e-03,
        -1.5835e-01, -2.3685e-01,  4.9761e-01, -4.2806e-01,  5.3752e-02,
        -2.9458e-01, -3.3832e-01, -2.0192e-01, -4.7910e-01, -2.5771e-01,
        -2.2665e-01, -4.2709e-02, -2.7293e-02, -3.4910e-01,  3.1658e-01,
         2.6990e-01,  1.0065e-01, -2.9282e-01, -3.1155e-01, -2.8499e-01,
        -2.3924e-01, -3.8425e-01, -2.3647e-01, -3.7499e-01, -2.3457e-01,
        -2.2808e-01, -4.5451e-02, -2.1563e-01,  2.3272e-01, -1.7155e-01,
         6.8016e-02, -2.3809e-01, -2.3056e-01,  7.0764e-02, -6.9263e-02,
        -2.4546e-01,  4.0917e-01, -3.2277e-02, -3.7279e-01,  1.6529e-02,
         3.0260e-04, -2.3740e-01,  3.7886e-01,  3.3873e-02,  1.5071e-01,
        -4.6330e-01,  1.8889e-01, -2.9298e-01,  3.3444e-01]), 'network.6.running_mean': tensor([1.5431, 1.2281, 1.3578, 1.1033, 1.1267, 1.1780, 0.3645, 0.8863, 1.0115,
        1.6247, 0.6777, 0.8165, 0.9635, 1.0527, 1.4311, 0.9098, 0.8779, 0.8498,
        1.0032, 1.1789, 0.7111, 1.0148, 0.7230, 1.0223, 0.6840, 0.8013, 1.0368,
        1.3926, 0.3710, 1.1947, 1.2175, 1.4232, 1.0247, 0.6165, 0.3178, 1.0236,
        0.9227, 0.8957, 0.4125, 0.7529, 1.3640, 1.3995, 0.9047, 1.1019, 1.3329,
        1.6279, 1.0911, 0.8670, 1.5023, 0.7839, 1.1248, 1.1050, 1.2241, 0.6649,
        0.8432, 1.6071, 0.8964, 0.8869, 1.5471, 1.3284, 1.1154, 1.1893, 0.7053,
        0.4788]), 'network.6.running_var': tensor([2.8518, 1.8705, 2.0471, 1.2927, 1.1989, 1.7255, 0.8106, 2.0739, 1.3688,
        2.7058, 1.4505, 1.3458, 1.9258, 2.1192, 2.5815, 2.4001, 2.4615, 0.6699,
        2.3221, 1.6495, 1.8887, 3.0654, 0.9137, 1.1876, 2.1358, 2.1949, 1.6573,
        2.5789, 0.6086, 1.0016, 1.2292, 2.1608, 2.7218, 1.0260, 0.5330, 2.2673,
        2.2297, 1.9581, 1.1050, 1.5398, 2.9298, 2.7257, 1.6501, 0.9710, 2.7726,
        2.4496, 2.2427, 2.5233, 2.1816, 0.8911, 3.0081, 1.0406, 2.2621, 1.5372,
        1.3447, 2.7763, 1.5745, 1.0302, 2.4839, 1.3729, 2.7951, 1.5096, 1.3805,
        0.5981]), 'network.6.num_batches_tracked': tensor(2349), 'network.8.weight': tensor([[ 0.0366,  0.1009, -0.0742,  ...,  0.0820,  0.0432,  0.0372],
        [ 0.0368,  0.1111, -0.0548,  ...,  0.0758, -0.0303,  0.1650],
        [-0.3636, -0.2845, -0.4229,  ..., -0.1203,  0.1873, -0.1584],
        ...,
        [-0.1474, -0.3219, -0.2231,  ..., -0.0464,  0.0488, -0.0924],
        [ 0.0325,  0.0220, -0.0262,  ..., -0.0773, -0.0533,  0.1787],
        [ 0.0877,  0.1035,  0.1001,  ...,  0.0202, -0.2394,  0.1725]]), 'network.8.bias': tensor([-0.1591,  0.3392,  0.5363,  0.5562,  0.4445,  0.2908,  0.3749, -0.0645,
         0.3890,  0.6068,  0.2468, -0.0714,  0.3770,  0.5281,  0.6771,  0.5411,
         0.5351,  0.0669,  0.4763,  0.3952,  0.3998,  0.3459,  0.6088,  0.3537,
        -0.2400,  0.3200,  0.5961,  0.6582,  0.5561,  0.5467,  0.4024,  0.3749]), 'network.10.weight': tensor([[-0.1878,  0.2483,  0.3029,  0.1498,  0.2640,  0.0301,  0.3901, -0.1902,
          0.1433,  0.2430,  0.2464, -0.0584,  0.2616,  0.2415,  0.2435,  0.1279,
          0.2701, -0.1427,  0.3570,  0.3342,  0.3300,  0.3979,  0.4903,  0.4458,
         -0.1759,  0.2249,  0.1447,  0.2276,  0.3970,  0.3188,  0.0890,  0.2416],
        [ 0.0873,  0.3201,  0.0820,  0.3480,  0.3219,  0.3514,  0.1797,  0.1669,
          0.2998,  0.1624, -0.1070,  0.0113,  0.3577,  0.2785,  0.2997,  0.4229,
          0.1129,  0.2106,  0.1385,  0.2956,  0.2165,  0.2714,  0.0937,  0.3440,
          0.0296,  0.2311,  0.2681,  0.1320,  0.1519,  0.2845,  0.3309,  0.2807]]), 'network.10.bias': tensor([0.3490, 0.3788])})}</code></pre>
</div>
</div>
<p>Here is the output from our grid search: ✅ Best Config:{‘Dropout’: 0.3, ‘Learning Rate’: 0.001, ‘Weight Decay’: 0.0, ‘Hidden Size’: 64, ‘Loss Function’: ‘winner_sensitive_loss’}</p>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader, TensorDataset</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Unpack best parameters</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>best_dropout <span class="op">=</span> best_config[<span class="st">"Dropout"</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>best_lr <span class="op">=</span> best_config[<span class="st">"Learning Rate"</span>]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>best_weight_decay <span class="op">=</span> best_config[<span class="st">"Weight Decay"</span>]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>best_hidden_size <span class="op">=</span> best_config[<span class="st">"Hidden Size"</span>]</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>best_loss_name <span class="op">=</span> best_config[<span class="st">"Loss Function"</span>]</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>best_loss_fn <span class="op">=</span> loss_fn_dict[best_loss_name]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Instantiate and train model on full training data</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> FootballNet(</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    input_size<span class="op">=</span>X_train_tensor.shape[<span class="dv">1</span>],</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    hidden_size<span class="op">=</span>best_hidden_size,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    dropout<span class="op">=</span>best_dropout</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(final_model.parameters(), lr<span class="op">=</span>best_lr, weight_decay<span class="op">=</span>best_weight_decay)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine train + val sets</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>full_X <span class="op">=</span> torch.cat([X_train_tensor, X_val_tensor], dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>full_y <span class="op">=</span> torch.cat([y_train_tensor, y_val_tensor], dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>full_loader <span class="op">=</span> DataLoader(TensorDataset(full_X, full_y), batch_size<span class="op">=</span><span class="dv">16</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>final_model.train()</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):  <span class="co"># You can change this as needed</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xb, yb <span class="kw">in</span> full_loader:</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        preds <span class="op">=</span> final_model(xb)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> best_loss_fn(preds, yb)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Evaluate on test set</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>final_model.<span class="bu">eval</span>()</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> final_model(X_test_tensor).numpy()</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_test_tensor.numpy()</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Separate metrics for home and away</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>y_true_home, y_true_away <span class="op">=</span> y_true[:, <span class="dv">0</span>], y_true[:, <span class="dv">1</span>]</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>y_pred_home, y_pred_away <span class="op">=</span> y_pred[:, <span class="dv">0</span>], y_pred[:, <span class="dv">1</span>]</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>mse_home <span class="op">=</span> mean_squared_error(y_true_home, y_pred_home)</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>mae_home <span class="op">=</span> mean_absolute_error(y_true_home, y_pred_home)</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>r2_home <span class="op">=</span> r2_score(y_true_home, y_pred_home)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>mse_away <span class="op">=</span> mean_squared_error(y_true_away, y_pred_away)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>mae_away <span class="op">=</span> mean_absolute_error(y_true_away, y_pred_away)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>r2_away <span class="op">=</span> r2_score(y_true_away, y_pred_away)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Print results</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"📊 Final Test Set Performance"</span>)</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🏠 Home  — MSE: </span><span class="sc">{</span>mse_home<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_home<span class="sc">:.2f}</span><span class="ss">, R²: </span><span class="sc">{</span>r2_home<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🚌 Away  — MSE: </span><span class="sc">{</span>mse_away<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_away<span class="sc">:.2f}</span><span class="ss">, R²: </span><span class="sc">{</span>r2_away<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>📊 Final Test Set Performance
🏠 Home  — MSE: 153.00, MAE: 10.06, R²: 0.108
🚌 Away  — MSE: 136.80, MAE: 9.57, R²: 0.109</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="309">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Random Forest</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, max_depth<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train_scaled, y_train)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on test set</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf.predict(X_test_scaled)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>mse_home_rf <span class="op">=</span> mean_squared_error(y_test[<span class="st">'score_home'</span>], y_pred_rf[:, <span class="dv">0</span>])</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>mae_home_rf <span class="op">=</span> mean_absolute_error(y_test[<span class="st">'score_home'</span>], y_pred_rf[:, <span class="dv">0</span>])</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>r2_home_rf <span class="op">=</span> r2_score(y_test[<span class="st">'score_home'</span>], y_pred_rf[:, <span class="dv">0</span>])</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>mse_away_rf <span class="op">=</span> mean_squared_error(y_test[<span class="st">'score_away'</span>], y_pred_rf[:, <span class="dv">1</span>])</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>mae_away_rf <span class="op">=</span> mean_absolute_error(y_test[<span class="st">'score_away'</span>], y_pred_rf[:, <span class="dv">1</span>])</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>r2_away_rf <span class="op">=</span> r2_score(y_test[<span class="st">'score_away'</span>], y_pred_rf[:, <span class="dv">1</span>])</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Home Score  — MSE: </span><span class="sc">{</span>mse_home_rf<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_home_rf<span class="sc">:.2f}</span><span class="ss">, R²: </span><span class="sc">{</span>r2_home_rf<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Away Score  — MSE: </span><span class="sc">{</span>mse_away_rf<span class="sc">:.2f}</span><span class="ss">, MAE: </span><span class="sc">{</span>mae_away_rf<span class="sc">:.2f}</span><span class="ss">, R²: </span><span class="sc">{</span>r2_away_rf<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> model_features</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> rf.feature_importances_</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>plt.barh(feature_names, importances)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Feature Importance'</span>)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Random Forest Feature Importance'</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Home Score  — MSE: 153.42, MAE: 10.10, R²: 0.106
Away Score  — MSE: 135.99, MAE: 9.45, R²: 0.114</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="313">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 1: Predict on test set ---</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using rolling linear regression model</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>y_pred_lin <span class="op">=</span> model.predict(X_test_scaled)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict using neural network model</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    y_pred_nn <span class="op">=</span> final_model(X_test_tensor).cpu().numpy()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 2: Compute residuals ---</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>resid_home_lin <span class="op">=</span> y_test[<span class="st">'score_home'</span>].values <span class="op">-</span> y_pred_lin[:, <span class="dv">0</span>]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>resid_away_lin <span class="op">=</span> y_test[<span class="st">'score_away'</span>].values <span class="op">-</span> y_pred_lin[:, <span class="dv">1</span>]</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>resid_home_nn <span class="op">=</span> y_test[<span class="st">'score_home'</span>].values <span class="op">-</span> y_pred_nn[:, <span class="dv">0</span>]</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>resid_away_nn <span class="op">=</span> y_test[<span class="st">'score_away'</span>].values <span class="op">-</span> y_pred_nn[:, <span class="dv">1</span>]</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 3: Plot residual histograms ---</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Home Residuals</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>sns.histplot(resid_home_lin, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Linear - Home"</span>)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>sns.histplot(resid_home_nn, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">"orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"NN - Home"</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Home Score Residuals"</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Away Residuals</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>sns.histplot(resid_away_lin, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Linear - Away"</span>)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>sns.histplot(resid_away_nn, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">"orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"NN - Away"</span>)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Score Residuals"</span>)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Error (points)"</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Step 4: Print MAE Comparison ---</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"📊 Mean Absolute Error Comparison:"</span>)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"• Home (Linear): </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.<span class="bu">abs</span>(resid_home_lin))<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"• Home (NN):     </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.<span class="bu">abs</span>(resid_home_nn))<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"• Away (Linear): </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.<span class="bu">abs</span>(resid_away_lin))<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"• Away (NN):     </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.<span class="bu">abs</span>(resid_away_nn))<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📊 Mean Absolute Error Comparison:
• Home (Linear): 10.05
• Home (NN):     10.06
• Away (Linear): 9.60
• Away (NN):     9.57</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>